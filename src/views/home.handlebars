
<div>

  <h1>
    Products
  </h1>
  <p>Bienvenido: {{user.first_name}} {{user.last_name}}</p><br />
  <p><a href="/profile">{{user.email}}</a>
    - role:{{user.role}}
    - [
    <a href="/api/sessions/logout">Logout</a>]</p>
  <hr />
  <div>
    {{#if paginateInfo.hasPrevPage}}
      <a href="{{paginateInfo.prevLink}}">Anterior</a>
    {{/if}}
    {{#each paginateInfo.totalPages}}
      <a href="{{this.link}}">{{this.page}}</a>
    {{/each}}
    {{#if paginateInfo.hasNextPage}}
      <a href="{{paginateInfo.nextLink}}">Siguiente</a>
    {{/if}}

  </div>

  <hr />
  <table>
    <thead>
      <tr>
        <td></td>
        <td>Nombre</td>
        <td>Descripción</td>
        <td>Precio</td>
        <td>Stock</td>
        <td>Código</td>
        <td>Categoría</td>
        <td>Status</td>
      </tr>
    </thead>
    <tbody>
      {{#each products}}
        <tr>
          <td><button
              onclick="addProductToCart('{{this._id}}')"
            >AddToCart</button></td>
          <td>{{this.title}}</td>
          <td>{{this.description}}</td>
          <td>{{this.price}}</td>
          <td>{{this.stock}}</td>
          <td>{{this.code}}</td>
          <td>{{this.category}}</td>
          <td>{{this.status}}</td>
        </tr>
      {{/each}}
    </tbody>
  </table>
</div>

<script>
  const addProductToCart = ( pid) => { 
          const cid = {{{json user.cart._id}}};
          fetch(`/api/carts/${cid}/products/${pid}`, { 
            method: 'post' 
            }) 
        .then(result => result.json()) 
        .then(result => { 
          if (result.status ==='error') throw new Error(result.error) 
          alert(`Ok. Todo salió bien! :)\nEl producto se agregó al carrito con id=${result.payload._id}!`) 
          }) 
        .catch(err => alert(`Ocurrió un error :(\n${err}`)) }

</script>